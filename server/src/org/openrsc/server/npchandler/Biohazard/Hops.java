/**
* Generated By NPCScript :: A scripting engine created for openrsc by Zilent
*/
//npc ID 506
package org.openrsc.server.npchandler.Biohazard;
import org.openrsc.server.event.DelayedQuestChat;
import org.openrsc.server.event.SingleEvent;
import org.openrsc.server.model.MenuHandler;
import org.openrsc.server.model.Npc;
import org.openrsc.server.model.Player;
import org.openrsc.server.model.Quest;
import org.openrsc.server.model.World;
import org.openrsc.server.npchandler.NpcHandler;


public class Hops implements NpcHandler
 {
	int wrongPot = 0;
	int correctPot = 0;
	
	public void handleNpc(final Npc npc, final Player owner) throws Exception
	{
		npc.blockedBy(owner);
		owner.setBusy(true);
		
		Quest q = owner.getQuest(38);
		
		if(q != null) 
		{	
			if(owner.getQuest(38) != null && owner.getQuest(38).getStage() == 7)
			{
				questStage7(npc, owner);
			}
			else
			{
				owner.sendMessage("Hops seems to be too busy to talk");
				owner.setBusy(false);
				npc.unblock();
			}	
		} 
		else
		{
			owner.sendMessage("Hops seems to be too busy to talk");
			owner.setBusy(false);
			npc.unblock();
		}
	}
	
	private void questStage7(final Npc npc, final Player owner) 
	{	
		if (owner.getX() <= 94) //change coords to varrock location
		{
			World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Hello, how was your journey?"}, true)
			{
				public void finished()
				{
					World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Pretty thirst-inducing actually..."})
					{
						public void finished()
						{
							World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Please tell me that you haven't drunk the contents"})
							{
								public void finished()
								{
						
									if (correctPot == 1)
									{
										World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Oh the gods no! What do you take me for?", "Besides, the smell kind of put me off", "Here's your vial anyway"})
										{
											public void finished()
											{
												owner.sendMessage("He gives you the vial of sulphuric broline");
												owner.getInventory().add(811, 1);
												owner.sendInventory();
												World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Thanks, I'll leave you to your drink now"})
												{
													public void finished()
													{
														correctPot--;
														owner.setBusy(false);
														npc.unblock();
													}
												});
											}
										});
									}
									else if (wrongPot == 1)
									{
										World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Of course! It was very tasty, thanks!"})
										{
											public void finished()
											{
												wrongPot--;
												owner.setBusy(false);
												npc.unblock();
											}
										});
									}
									else
									{
										owner.setBusy(false);
										npc.unblock();
									}
								}
							});								
						}
					});
				}
			});
		}
		else
		{
			if (correctPot == 1 || wrongPot == 1)
			{
				World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"I'll meet you at the dancing donkey in varrock"}, true)
				{
					public void finished()
					{
						owner.setBusy(false);
						npc.unblock();
					}
				});
			}
			else
			{
				World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Hi, I've got something for you to take to Varrock"}, true)
				{
					public void finished()
					{
						World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Sounds like pretty thirsty work"})
						{
							public void finished()
							{
								World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Well, there's a pub in Varrock is you're desperate"})
								{
									public void finished()
									{
										World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Don't worry, I'm a pretty resourceful fellow you know"})
										{
											public void finished()
											{
												World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
												{
													public void action()
													{
														final String[] options107 = {"Give him the vial of ethenea", "Give him the vial of liquid honey", "Give him the vial of sulphuric broline"};
														owner.setBusy(false);
														owner.sendMenu(options107);
														owner.setMenuHandler(new MenuHandler(options107) 
														{
															public void handleReply(final int option, final String reply)
															{
																owner.setBusy(true);
																switch(option) 
																{
																	case 0:
																		if(owner.getInventory().countId(810) == 0)
																		{
																			owner.sendMessage("You dont have a vial of ethernea to give");
																			owner.setBusy(false);
																			npc.unblock();
																		}
																		else
																		{
																			wrongPot++;
																			owner.getInventory().remove(810, 1);
																			owner.sendInventory();
																			owner.sendMessage("You give him the vial of ethernea");
																			World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Ok, I'll see you in Varrock"})
																			{
																				public void finished()
																				{
																					World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Sure, I'm a regular at the dancing donkey inn as it happens"})
																					{
																						public void finished()
																						{
																							owner.setBusy(false);
																							npc.unblock();
																						}
																					});
																				}
																			});
																		}
																	break;
																	case 1:
																		if(owner.getInventory().countId(809) == 0)
																		{
																			owner.sendMessage("You dont have a vial of liquid honey to give");
																			owner.setBusy(false);
																			npc.unblock();
																		}
																		else
																		{
																			wrongPot++;
																			owner.getInventory().remove(809, 1);
																			owner.sendInventory();
																			owner.sendMessage("You give him the vial of liquid honey");
																			World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Ok, I'll see you in Varrock"})
																			{
																				public void finished()
																				{
																					World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Sure, I'm a regular at the dancing donkey inn as it happens"})
																					{
																						public void finished()
																						{
																							owner.setBusy(false);
																							npc.unblock();
																						}
																					});
																				}
																			});
																		}
																	break;
																	case 2:
																		if(owner.getInventory().countId(811) == 0)
																		{
																			owner.sendMessage("You dont have a vial of sulphuric broline to give");
																			owner.setBusy(false);
																			npc.unblock();
																		}
																		else
																		{
																			correctPot++;
																			owner.getInventory().remove(811, 1);
																			owner.sendInventory();
																			owner.sendMessage("You give him the vial of sulphuric broline");
																			World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Ok, I'll see you in Varrock"})
																			{
																				public void finished()
																				{
																					World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Sure, I'm a regular at the dancing donkey inn as it happens"})
																					{
																						public void finished()
																						{
																							owner.setBusy(false);
																							npc.unblock();
																						}
																					});
																				}
																			});
																		}
																	break;
																}
															}
														});
													}
												});
											}
										});
									}
								});
							}
						});
					}
				});
			}	
		}
	}
	
}