/**
* Generated By NPCScript :: A scripting engine created for openrsc by Zilent

script put together by Mr.Zain
*/
package org.openrsc.server.npchandler;
import org.openrsc.server.event.DelayedQuestChat;
import org.openrsc.server.event.ShortEvent;
import org.openrsc.server.event.SingleEvent;
import org.openrsc.server.model.ChatMessage;
import org.openrsc.server.model.InvItem;
import org.openrsc.server.model.MenuHandler;
import org.openrsc.server.model.Npc;
import org.openrsc.server.model.Player;
import org.openrsc.server.model.Quest;
import org.openrsc.server.model.Shop;
import org.openrsc.server.model.World;
import org.openrsc.server.npchandler.NpcHandler;



public class Gerrant implements NpcHandler 
{

	public void handleNpc(final Npc npc, final Player owner) throws Exception 
	{
	
		npc.blockedBy(owner);
		owner.setBusy(true);
		
		Quest q = owner.getQuest(20);
		
		if(q != null) 
		{
			if (owner.getInventory().countId(587) >= 1)
			{
				normalShop(npc, owner);
			}
			else
			{
				questShop(npc , owner);
			}
		} 
		else
		{
			normalShop(npc, owner);
		}
	}
	
	private void questShop(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Welcome you can buy fishing equipment at my store", "We'll also buy anything you catch off you"}, true) 
		{
			public void finished()
			{
				World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
				{
					public void action()
					{
						final String[] options107 = {"Let's see What you've got then", "Sorry, I'm not interested", "I want to find out how to catch a lava eel"};
						owner.setBusy(false);
						owner.sendMenu(options107);
						owner.setMenuHandler(new MenuHandler(options107) 
						{
							public void handleReply(final int option, final String reply)
							{
								owner.setBusy(true);
								for(Player informee : owner.getViewArea().getPlayersInView())
								{
									informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
								}
								switch(option) 
								{
									case 0:
										final Shop shop = World.getShop(npc.getLocation());
										World.getDelayedEventHandler().add(new ShortEvent(owner) 
										{
											public void action() 
											{
												owner.setBusy(false);
												owner.setAccessingShop(shop);
												owner.showShop(shop);
											}
										});
									break;
									case 1:
										owner.setBusy(false);
										npc.unblock();
									break;
									case 2:
										World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Lava eels eh?", "That's a tricky one that is", "I wouldn't even know where to find them myself", "Probably in some lava somewhere", "You'll also need a lava proof fishing line", "The method for this would be to take an ordinary fishing rod", "And cover it with fire proof blamish oil", "Now I may have a jar of Blamish snail slime", "I wonder where I put it"}) 
										{
											public void finished()
											{
												World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
												{
													public void action()
													{
														owner.sendMessage("Gerrant searches about a bit");
														World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Aha, here it is"}) 
														{
															public void finished()
															{
																World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
																{
																	public void action()
																	{
																		owner.sendMessage("Gerrant passes you a small jar");
																		owner.getInventory().add(587, 1);
																		owner.sendInventory();
																		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"You'll need to mix this with some of the Harralander herb and water"}) 
																		{
																			public void finished()
																			{
																				owner.setBusy(false);
																				npc.unblock();
																			}
																		});
																	}
																});
															}
														});
													}
												});
											}
										});
									break;
								}
							}
						});
					}
				});
			}
		});
	}
		
	private void normalShop(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Welcome you can buy fishing equipment at my store", "We'll also buy anything you catch off you"}, true) 
		{
			public void finished()
			{
				World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
				{
					public void action()
					{
						final String[] options107 = {"Let's see What you've got then", "Sorry, I'm not interested"};
						owner.setBusy(false);
						owner.sendMenu(options107);
						owner.setMenuHandler(new MenuHandler(options107) 
						{
							public void handleReply(final int option, final String reply)
							{
								owner.setBusy(true);
								for(Player informee : owner.getViewArea().getPlayersInView())
								{
									informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
								}
								switch(option) 
								{
									case 0:
										final Shop shop = World.getShop(npc.getLocation());
										World.getDelayedEventHandler().add(new ShortEvent(owner) 
										{
											public void action() 
											{
												owner.setBusy(false);
												owner.setAccessingShop(shop);
												owner.showShop(shop);
											}
										});
									break;
									case 1:
										owner.setBusy(false);
										npc.unblock();
									break;
								}
							}
						});
					}
				});
			}
		});
	}
}