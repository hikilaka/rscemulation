/**
* Generated By NPCScript :: A scripting engine created for openrsc by Zilent <<-- fucking ditcher
*/
package org.openrsc.server.npchandler.Merlins_Crystal;
import org.openrsc.server.event.DelayedQuestChat;
import org.openrsc.server.event.SingleEvent;
import org.openrsc.server.model.Npc;
import org.openrsc.server.model.Player;
import org.openrsc.server.model.Quest;
import org.openrsc.server.model.World;
import org.openrsc.server.npchandler.NpcHandler;



public class CandleMaker implements NpcHandler 
{

	public void handleNpc(final Npc npc, final Player owner) throws Exception 
	{
		npc.blockedBy(owner);
		owner.setBusy(true);
		
		Quest q = owner.getQuest(22);
		
		if(q != null) 
		{
			if(q.finished()) 
			{
				owner.sendMessage("The candlemaker is not interested in talking");
				owner.setBusy(false);
				npc.unblock();
			} 
			else 
			{
				if(owner.getQuest(22) != null && owner.getQuest(22).getStage() == 4)
				{
					World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Hi welcome to my candle shop", "What can I do for you?"}, true) 
					{
						public void finished() 
						{
							if(owner.getInventory().countId(605) >= 1)
							{
								hasWax(npc, owner);
							}
							else
							{
								needsWax(npc, owner);
							}
						}
					});	
				}
				else
				{
					owner.sendMessage("The candlemaker is not interested in talking");
					owner.setBusy(false);
					npc.unblock();
				}
			}
		} 
		else 
		{
			owner.sendMessage("The candlemaker is not interested in talking");
			owner.setBusy(false);
			npc.unblock();
		}
	}
	
	public void hasWax(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Hello again, I have the wax here to make the black candle"}) 
		{
			public void finished() 
			{
				World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Alright, hand it here then"}) 
				{
					public void finished() 
					{
						World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
						{
							public void action()
							{
								owner.sendMessage("You give the candlemaker the wax");
								owner.getInventory().remove(605, 1);
								owner.sendInventory();
								World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
								{
									public void action()
									{
										owner.sendMessage("He crafts it into a black candle");
										World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
										{
											public void action()
											{
												owner.sendMessage("And gives it to you");
												owner.getInventory().add(600, 1);
												owner.sendInventory();
												owner.setBusy(false);
												npc.unblock();
											}
										});
									}
								});
							}
						});
					}
				});
			}
		});
	}
	
	public void needsWax(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Hi, I need to get my hands on a black candle", "Do you know where to get one?"}) 
		{
			public void finished() 
			{
				World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Yeah I can make one for you if you want", "I just need the wax to make it", "You can get some from the beehives to the west"}) 
				{
					public void finished() 
					{
						owner.setBusy(false);
						npc.unblock();
					}
				});
			}
		});
	}
	
}